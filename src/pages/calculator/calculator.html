<wide-header-page>
  <div page-content class="calculator-page">
    <ion-list class="calculator-list bp-list">
      <div class="calculator-explanation">
        <div class="calculator-heading" translate>Calculator</div>
      </div>

      <form [formGroup]="calculatorForm">
        <div class="calculator-form-group" [ngClass]="{error: calculationError}">
          <ion-item class="calculator-input">
            <ion-label stacked>{{'Send' | translate}}</ion-label>
            <ion-input
              [disabled]="!rates && calculationError"
              type="number"
              formControlName="sendAmount"
              OnlyNumber="true"
              required
            >
            </ion-input>
          </ion-item>

          <ion-item
            class="calculator-select calculator-loading-select"
            *ngIf="!rates"
          >
            <ion-spinner name="dots"></ion-spinner>
          </ion-item>

          <ion-item class="calculator-select" *ngIf="rates">
            <ion-select
              class="calculator-select-ion"
              interface="popover"
              formControlName="sendCoin"
            >
              <ion-option
                *ngFor="let item of convertSendCoins"
                [value]="item"
                >{{ item }}</ion-option
              >
            </ion-select>
          </ion-item>
        </div>

        <ion-item class="calculator-text" *ngIf="!rates">
          <ion-spinner name="dots"></ion-spinner>
        </ion-item>
        <!-- *ngIf="formCoins.get.name !== 'WDUCX'; else elseTemplate" -->
        <ion-item class="calculator-text" *ngIf="rates">
      
          <ion-label stacked
          >1 {{ coin_info[calculatorForm.value.sendCoin] }} 
           = {{ valueGetForOneCoin }} 
           {{coin_info[calculatorForm.value.getCoin] }}</ion-label
        >
        
        </ion-item>

        <div class="calculator-form-group" [ngClass]="{error: calculationError}">
          <ion-item class="calculator-input">
            <ion-label stacked>{{'Get' | translate}}</ion-label>
            <ion-input
              [disabled]="!rates && calculationError"
              type="number"
              formControlName="getAmount"
              OnlyNumber="true"
              required
            >
            </ion-input>
          </ion-item>

          <ion-item
            class="calculator-select calculator-loading-select"
            *ngIf="!rates"
          >
            <ion-spinner name="dots"></ion-spinner>
          </ion-item>

          <ion-item class="calculator-select" *ngIf="rates">
            <ion-select
              class="calculator-select-ion"
              interface="popover"
              formControlName="getCoin"
            >
              <ion-option *ngFor="let item of formCoins.get.items" [value]="item">
                {{ item }}</ion-option
              >
            </ion-select>
          </ion-item>
        </div>

        <div class="calculator-attention" *ngIf="!isAvailableSwap">
          {{this.formCoins.send}} to {{this.formCoins.get.name}} swap is
          currently restricted, please try again later
        </div>

        <button
          ion-button
          class="button-standard calculator-button"
          (click)="goToConvertPage()"
          [disabled]="!calculatorForm.valid || !rates || !isAvailableSwap"
          *ngIf="isAvailableSwap"
        >
          {{'Convert' | translate}}
        </button>

        <button
          ion-button
          class="button-standard calculator-swap-button"
          (click)="showSwapHistory()"
          [disabled]="!historyIsLoaded || !swapHistory || !swapHistory.length"
        >
          {{ this.isShowSwapHistory ? 'Hide SWAP History' : 'View SWAP History' }}
        </button>
      </form>
    </ion-list>

    <ion-list *ngIf="isShowSwapHistory && swapHistory && swapHistory[0]" class="tx-history">

      <div class="item-wrapper" *ngFor="let tx of swapHistory; trackBy: trackByFn; let i = index">

        <button ion-item (click)="itemTapped(tx)">

          <ion-icon class="item-img" item-start>
            <div *ngIf="tx.confirmations > 0">
              <span>
                <img src="assets/img/tx-action/swap.svg" width="40">
              </span>
            </div>
          </ion-icon>

          <div class="action" *ngIf="tx.confirmations > 0 && tx.action == 'moved'">
            <span *ngIf="(tx.message && (tx.note && !tx.note.body))" translate>Moved</span>
            <span *ngIf="((!tx.note || (tx.note && !tx.note.body)) && !tx.message)" translate>Moved</span>
            <span *ngIf="!tx.note && tx.message">{{tx.message}}</span>
            <span *ngIf="tx.note && tx.note.body != ''">{{tx.note.body}}</span>
          </div>

          <div class="action" *ngIf="tx.swap">
            <div>
              <span>Swap from {{tx.swap.convertedFrom}} to {{tx.swap.convertedTo}}</span>
            </div>
            <div class="swap-block">
              <span class="swap-block-amount">{{tx.amountStr}}</span>
            </div>
            <div class="swap-block">
              <span>Status</span> 
              <span class="swap-block-status">{{tx.swap.status}}</span>
            </div>
          </div>

          <ion-note item-end text-end>
            <div class="date">
              <span *ngIf="tx.time && createdWithinPastDay(tx.time * 1000)">{{tx.time * 1000 | amTimeAgo}}</span>
              <span *ngIf="tx.time && !createdWithinPastDay(tx.time * 1000)">
                {{tx.time * 1000 | amDateFormat:'MMMD, YYYY'}}
              </span>
            </div>
          </ion-note> 
        </button>
      </div>
    </ion-list>

  </div>
</wide-header-page>
